(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();const p={king:"fa-chess-king",queen:"fa-chess-queen",rook:"fa-chess-rook",bishop:"fa-chess-bishop",knight:"fa-chess-knight",pawn:"fa-chess-pawn",trebuchet:"fa-tower-observation"},g={king:[{dx:-1,dy:-1},{dx:-1,dy:0},{dx:-1,dy:1},{dx:0,dy:-1},{dx:0,dy:1},{dx:1,dy:-1},{dx:1,dy:0},{dx:1,dy:1}],queen:[{dx:-1,dy:0},{dx:1,dy:0},{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:-1},{dx:-1,dy:1},{dx:1,dy:-1},{dx:1,dy:1}],rook:[{dx:-1,dy:0},{dx:1,dy:0},{dx:0,dy:-1},{dx:0,dy:1}],bishop:[{dx:-1,dy:-1},{dx:-1,dy:1},{dx:1,dy:-1},{dx:1,dy:1}],knight:[{dx:-2,dy:-1},{dx:-2,dy:1},{dx:-1,dy:-2},{dx:-1,dy:2},{dx:1,dy:-2},{dx:1,dy:2},{dx:2,dy:-1},{dx:2,dy:1}],pawn:{white:[{dx:0,dy:1},{dx:0,dy:2}],black:[{dx:0,dy:-1},{dx:0,dy:-2}]}};class m{constructor(){this.board=Array(10).fill().map(()=>Array(10).fill(null)),this.currentPlayer="white",this.gameHistory=[],this.capturedPieces={white:[],black:[]},this.moveCount=0,this.reset()}reset(){this.board=Array(10).fill().map(()=>Array(10).fill(null)),this.currentPlayer="white",this.gameHistory=[],this.capturedPieces={white:[],black:[]},this.moveCount=0,this.board[0][0]={type:"trebuchet",color:"white"},this.board[0][1]={type:"rook",color:"white"},this.board[0][2]={type:"knight",color:"white"},this.board[0][3]={type:"bishop",color:"white"},this.board[0][4]={type:"queen",color:"white"},this.board[0][5]={type:"king",color:"white"},this.board[0][6]={type:"bishop",color:"white"},this.board[0][7]={type:"knight",color:"white"},this.board[0][8]={type:"rook",color:"white"},this.board[0][9]={type:"trebuchet",color:"white"};for(let e=0;e<10;e++)this.board[1][e]={type:"pawn",color:"white"};this.board[9][0]={type:"trebuchet",color:"black"},this.board[9][1]={type:"rook",color:"black"},this.board[9][2]={type:"knight",color:"black"},this.board[9][3]={type:"bishop",color:"black"},this.board[9][4]={type:"queen",color:"black"},this.board[9][5]={type:"king",color:"black"},this.board[9][6]={type:"bishop",color:"black"},this.board[9][7]={type:"knight",color:"black"},this.board[9][8]={type:"rook",color:"black"},this.board[9][9]={type:"trebuchet",color:"black"};for(let e=0;e<10;e++)this.board[8][e]={type:"pawn",color:"black"}}getAvailableMoves(e,t){const s=this.board[t][e];if(!s)return[];const i=[];if(s.type==="trebuchet")return this.getTrebuchetMoves(e,t);if(s.type==="pawn")return this.getPawnMoves(e,t);const r=g[s.type];for(const o of r){let c=o.dx,a=o.dy,l=e+c,n=t+a;if(l<0||l>=10||n<0||n>=10)continue;const h=this.board[n][l];if(["queen","rook","bishop"].includes(s.type)){let u=this.getSlidingMoves(e,t,c,a);i.push(...u)}else(!h||h.color!==s.color)&&i.push({file:l,rank:n,capture:!!h})}return i}getSlidingMoves(e,t,s,i){const r=[],o=this.board[t][e];for(let c=1;c<10;c++){const a=e+s*c,l=t+i*c;if(a<0||a>=10||l<0||l>=10)break;const n=this.board[l][a];if(!n)r.push({file:a,rank:l,capture:!1});else{n.color!==o.color&&r.push({file:a,rank:l,capture:!0});break}}return r}getTrebuchetMoves(e,t){const s=[],i=this.board[t][e];for(let r=0;r<10;r++)for(let o=0;o<10;o++){const c=Math.abs(r-e),a=Math.abs(o-t);if(Math.max(c,a)===3&&!(c===0&&a===0)){const n=this.board[o][r];(!n||n.color!==i.color)&&s.push({file:r,rank:o,capture:!!n})}}return s}getPawnMoves(e,t){const s=[],i=this.board[t][e],r=i.color==="white"?1:-1,o=t+r;if(o>=0&&o<10&&!this.board[o][e]){s.push({file:e,rank:o,capture:!1});const a=t+r*2;a>=0&&a<10&&!this.board[a][e]&&s.push({file:e,rank:a,capture:!1})}const c=[e-1,e+1];for(const a of c)if(a>=0&&a<10){const l=t+r;if(l>=0&&l<10){const n=this.board[l][a];n&&n.color!==i.color&&s.push({file:a,rank:l,capture:!0})}}return s}movePiece(e,t,s,i){const r=this.board[t][e];if(!r||!this.getAvailableMoves(e,t).some(l=>l.file===s&&l.rank===i))return!1;r.type==="pawn"&&(r.color==="white"&&i===9||r.color==="black"&&i===0)&&(r.type="queen"),this.board[i][s]=r,this.board[t][e]=null;const a=this.board[i][s];return a&&a.color!==r.color&&this.capturedPieces[r.color].push(a),this.gameHistory.push({from:{file:e,rank:t},to:{file:s,rank:i},piece:{...r},captured:a}),this.currentPlayer=this.currentPlayer==="white"?"black":"white",this.moveCount++,!0}undoMove(){if(this.gameHistory.length===0)return!1;const e=this.gameHistory.pop();return this.board[e.from.rank][e.from.file]=e.piece,this.board[e.to.rank][e.to.file]=e.captured||null,e.captured&&this.capturedPieces[e.piece.color].pop(),this.currentPlayer=this.currentPlayer==="white"?"black":"white",this.moveCount--,!0}isCheck(){let e,t;for(let s=0;s<10;s++)for(let i=0;i<10;i++){const r=this.board[s][i];if(r&&r.type==="king"&&r.color===this.currentPlayer){e=i,t=s;break}}if(e===void 0||t===void 0)return!1;for(let s=0;s<10;s++)for(let i=0;i<10;i++){const r=this.board[s][i];if(r&&r.color!==this.currentPlayer&&this.getAvailableMoves(i,s).some(a=>a.file===e&&a.rank===t))return!0}return!1}isCheckmate(){if(!this.isCheck())return!1;for(let e=0;e<10;e++)for(let t=0;t<10;t++){const s=this.board[e][t];if(s&&s.color===this.currentPlayer&&this.getAvailableMoves(t,e).length>0)return!1}return!0}getPieceIcon(e){return e?p[e.type]:null}}class f{constructor(){this.boardElement=document.getElementById("chessBoard")}initializeBoard(){this.boardElement.innerHTML="";for(let e=0;e<10;e++)for(let t=0;t<10;t++){const s=document.createElement("div");s.className="cell",s.dataset.coord=`${t}${e}`,(t+e)%2===0?s.classList.add("light-square"):s.classList.add("dark-square"),this.boardElement.appendChild(s)}}renderBoard(e){document.querySelectorAll(".chess-piece").forEach(i=>i.remove());const s=e.flippedBoard||e;for(let i=0;i<10;i++)for(let r=0;r<10;r++){const o=s[i][r];if(o){const c=o.displayColor||o.color;this.renderPiece(r,i,{...o,color:c})}}}renderPiece(e,t,s){const i=this.getCellElement(e,t);if(!i)return;const r=i.querySelector(".chess-piece");r&&r.remove();const o=document.createElement("i");o.className=`fas ${this.getPieceIcon(s.type)} chess-piece ${s.color}`,o.dataset.piece=s.type,o.dataset.color=s.color,i.appendChild(o)}getPieceIcon(e){return{king:"fa-chess-king",queen:"fa-chess-queen",rook:"fa-chess-rook",bishop:"fa-chess-bishop",knight:"fa-chess-knight",pawn:"fa-chess-pawn",trebuchet:"fa-tower-observation"}[e]||"fa-question"}getCellElement(e,t){return document.querySelector(`.cell[data-coord="${e}${t}"]`)}highlightPiece(e,t,s){const i=this.getCellElement(e,t);i&&i.classList.add(s)}highlightMoves(e){this.clearMoveHighlights(),e.forEach(t=>{const s=this.getCellElement(t.file,t.rank);if(s){const i=document.createElement("div");i.className=`highlight ${t.capture?"capture-move":"available-move"}`,s.appendChild(i)}})}clearHighlights(){this.clearSelectionHighlights(),this.clearMoveHighlights()}clearSelectionHighlights(){document.querySelectorAll(".selected-piece").forEach(t=>{t.classList.remove("selected-piece")})}clearMoveHighlights(){document.querySelectorAll(".highlight").forEach(t=>{t.remove()})}}class y{constructor(){this.game=new m,this.renderer=new f,this.selectedPiece=null,this.availableMoves=[],this.initialize()}initialize(){this.renderer.initializeBoard(),this.renderer.renderBoard(this.game.board),this.setupEventListeners(),this.updateGameStatus()}setupEventListeners(){document.getElementById("chessBoard").addEventListener("click",e=>{const t=e.target.closest(".cell");if(!t)return;const s=t.dataset.coord,i=parseInt(s[0]),r=parseInt(s[1]);this.handleCellClick(i,r)}),document.getElementById("resetGame").addEventListener("click",()=>{this.game.reset(),this.renderer.renderBoard(this.game.board),this.updateGameStatus(),this.clearHighlights()}),document.getElementById("undoMove").addEventListener("click",()=>{this.game.undoMove(),this.renderer.renderBoard(this.game.board),this.updateGameStatus(),this.clearHighlights()}),document.getElementById("newGame").addEventListener("click",()=>{this.showGameSetupModal()}),document.getElementById("startGame").addEventListener("click",()=>{this.startNewGame()}),document.getElementById("cancelGame").addEventListener("click",()=>{this.hideGameSetupModal()})}handleCellClick(e,t){const s=this.game.board[t][e];if(this.selectedPiece&&(this.selectedPiece.file!==e||this.selectedPiece.rank!==t)&&this.availableMoves.some(r=>r.file===e&&r.rank===t)){this.game.movePiece(this.selectedPiece.file,this.selectedPiece.rank,e,t),this.renderer.renderBoard(this.game.board),this.updateGameStatus(),this.clearHighlights();return}s&&s.color===this.game.currentPlayer?(this.availableMoves=this.game.getAvailableMoves(e,t),this.renderer.highlightPiece(e,t,"selected-piece"),this.renderer.highlightMoves(this.availableMoves),this.selectedPiece={file:e,rank:t,piece:s}):(this.clearHighlights(),this.selectedPiece=null,this.availableMoves=[])}clearHighlights(){this.renderer.clearHighlights()}updateGameStatus(){const e=document.getElementById("gameStatus");e.textContent=`${this.game.currentPlayer.charAt(0).toUpperCase()+this.game.currentPlayer.slice(1)}'s turn`,this.game.isCheck()&&(e.textContent+=" - CHECK!"),this.game.isCheckmate()&&(e.textContent=`CHECKMATE! ${this.game.currentPlayer==="white"?"Black":"White"} wins!`)}showGameSetupModal(){const e=document.getElementById("gameSetupModal");e.style.display="flex"}hideGameSetupModal(){const e=document.getElementById("gameSetupModal");e.style.display="none"}startNewGame(){const e=document.getElementById("boardOrientation").value,t=document.getElementById("gameMode").value;this.game.reset(),e==="black-bottom"?this.flipBoardOrientation():this.ensureNormalOrientation();const[s,i]=t.split("-");this.game.bottomPlayerType=s,this.game.topPlayerType=i,this.game.currentPlayer=e==="black-bottom"?"black":"white",this.renderer.renderBoard(this.game.board),this.updateGameStatus(),this.clearHighlights(),this.hideGameSetupModal(),console.log(`Starting new game: ${t} with ${e}`),console.log(`Bottom: ${s}, Top: ${i}`)}flipBoardOrientation(){const e=Array(10).fill().map(()=>Array(10).fill(null));for(let t=0;t<10;t++)for(let s=0;s<10;s++){const i=this.game.board[t][s];i&&(e[9-t][9-s]={...i,displayColor:i.color==="white"?"black":"white"})}this.game.flippedBoard=e,this.game.boardOrientation="flipped"}ensureNormalOrientation(){this.game.boardOrientation="normal",delete this.game.flippedBoard}}document.addEventListener("DOMContentLoaded",()=>{new y});

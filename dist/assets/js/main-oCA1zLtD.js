(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}})();const p={king:"fa-chess-king",queen:"fa-chess-queen",rook:"fa-chess-rook",bishop:"fa-chess-bishop",knight:"fa-chess-knight",pawn:"fa-chess-pawn",trebuchet:"fa-tower-observation"},m={king:[{dx:-1,dy:-1},{dx:-1,dy:0},{dx:-1,dy:1},{dx:0,dy:-1},{dx:0,dy:1},{dx:1,dy:-1},{dx:1,dy:0},{dx:1,dy:1}],queen:[{dx:-1,dy:0},{dx:1,dy:0},{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:-1},{dx:-1,dy:1},{dx:1,dy:-1},{dx:1,dy:1}],rook:[{dx:-1,dy:0},{dx:1,dy:0},{dx:0,dy:-1},{dx:0,dy:1}],bishop:[{dx:-1,dy:-1},{dx:-1,dy:1},{dx:1,dy:-1},{dx:1,dy:1}],knight:[{dx:-2,dy:-1},{dx:-2,dy:1},{dx:-1,dy:-2},{dx:-1,dy:2},{dx:1,dy:-2},{dx:1,dy:2},{dx:2,dy:-1},{dx:2,dy:1}],pawn:{white:[{dx:0,dy:1},{dx:0,dy:2}],black:[{dx:0,dy:-1},{dx:0,dy:-2}]}};class g{constructor(){this.board=Array(10).fill().map(()=>Array(10).fill(null)),this.currentPlayer="white",this.gameHistory=[],this.redoStack=[],this.capturedPieces={white:[],black:[]},this.moveCount=0,this.moveNotation=[],this.reset()}reset(){this.board=Array(10).fill().map(()=>Array(10).fill(null)),this.currentPlayer="white",this.gameHistory=[],this.capturedPieces={white:[],black:[]},this.moveCount=0,this.board[0][0]={type:"trebuchet",color:"white"},this.board[0][1]={type:"rook",color:"white"},this.board[0][2]={type:"knight",color:"white"},this.board[0][3]={type:"bishop",color:"white"},this.board[0][4]={type:"queen",color:"white"},this.board[0][5]={type:"king",color:"white"},this.board[0][6]={type:"bishop",color:"white"},this.board[0][7]={type:"knight",color:"white"},this.board[0][8]={type:"rook",color:"white"},this.board[0][9]={type:"trebuchet",color:"white"};for(let e=0;e<10;e++)this.board[1][e]={type:"pawn",color:"white"};this.board[9][0]={type:"trebuchet",color:"black"},this.board[9][1]={type:"rook",color:"black"},this.board[9][2]={type:"knight",color:"black"},this.board[9][3]={type:"bishop",color:"black"},this.board[9][4]={type:"queen",color:"black"},this.board[9][5]={type:"king",color:"black"},this.board[9][6]={type:"bishop",color:"black"},this.board[9][7]={type:"knight",color:"black"},this.board[9][8]={type:"rook",color:"black"},this.board[9][9]={type:"trebuchet",color:"black"};for(let e=0;e<10;e++)this.board[8][e]={type:"pawn",color:"black"}}getAvailableMoves(e,t){const i=this.board[t][e];if(!i)return[];const o=[];if(i.type==="trebuchet")return this.getTrebuchetMoves(e,t);if(i.type==="pawn")return this.getPawnMoves(e,t);const r=m[i.type];for(const s of r){let c=s.dx,a=s.dy,n=e+c,l=t+a;if(n<0||n>=10||l<0||l>=10)continue;const h=this.board[l][n];if(["queen","rook","bishop"].includes(i.type)){let u=this.getSlidingMoves(e,t,c,a);o.push(...u)}else(!h||h.color!==i.color)&&o.push({file:n,rank:l,capture:!!h})}return o}getSlidingMoves(e,t,i,o){const r=[],s=this.board[t][e];for(let c=1;c<10;c++){const a=e+i*c,n=t+o*c;if(a<0||a>=10||n<0||n>=10)break;const l=this.board[n][a];if(!l)r.push({file:a,rank:n,capture:!1});else{l.color!==s.color&&r.push({file:a,rank:n,capture:!0});break}}return r}getTrebuchetMoves(e,t){const i=[],o=this.board[t][e];for(let r=0;r<10;r++)for(let s=0;s<10;s++){const c=Math.abs(r-e),a=Math.abs(s-t);if(Math.max(c,a)===3&&!(c===0&&a===0)){const l=this.board[s][r];(!l||l.color!==o.color)&&i.push({file:r,rank:s,capture:!!l})}}return i}getPawnMoves(e,t){const i=[],o=this.board[t][e],r=o.color==="white"?1:-1,s=t+r;if(s>=0&&s<10&&!this.board[s][e]){i.push({file:e,rank:s,capture:!1});const a=t+r*2;a>=0&&a<10&&!this.board[a][e]&&i.push({file:e,rank:a,capture:!1})}const c=[e-1,e+1];for(const a of c)if(a>=0&&a<10){const n=t+r;if(n>=0&&n<10){const l=this.board[n][a];l&&l.color!==o.color&&i.push({file:a,rank:n,capture:!0})}}return i}movePiece(e,t,i,o){const r=this.board[t][e];if(!r||!this.getAvailableMoves(e,t).some(l=>l.file===i&&l.rank===o))return!1;r.type==="pawn"&&(r.color==="white"&&o===9||r.color==="black"&&o===0)&&(r.type="queen");const a=this.generateMoveNotation(r,e,t,i,o);this.board[o][i]=r,this.board[t][e]=null;const n=this.board[o][i];return n&&n.color!==r.color&&this.capturedPieces[r.color].push(n),this.gameHistory.push({from:{file:e,rank:t},to:{file:i,rank:o},piece:{...r},captured:n,notation:a}),this.moveNotation.push({moveNumber:Math.floor(this.moveCount/2)+1,player:this.currentPlayer,notation:a}),this.redoStack=[],this.currentPlayer=this.currentPlayer==="white"?"black":"white",this.moveCount++,!0}undoMove(){if(this.gameHistory.length===0)return!1;const e=this.gameHistory.pop();return this.redoStack.push(e),this.board[e.from.rank][e.from.file]=e.piece,this.board[e.to.rank][e.to.file]=e.captured||null,e.captured&&this.capturedPieces[e.piece.color].pop(),this.moveNotation.pop(),this.currentPlayer=this.currentPlayer==="white"?"black":"white",this.moveCount--,!0}redoMove(){if(this.redoStack.length===0)return!1;const e=this.redoStack.pop(),t=this.board[e.from.rank][e.from.file];return t?(this.board[e.to.rank][e.to.file]=t,this.board[e.from.rank][e.from.file]=null,e.captured&&this.capturedPieces[t.color].push(e.captured),this.gameHistory.push(e),this.moveNotation.push({moveNumber:Math.floor(this.moveCount/2)+1,player:this.currentPlayer,notation:e.notation}),this.currentPlayer=this.currentPlayer==="white"?"black":"white",this.moveCount++,!0):!1}generateMoveNotation(e,t,i,o,r){const s=e.type.charAt(0).toUpperCase(),c=`${t}${i}`,a=`${o}${r}`,n=this.board[r][o];return n&&n.color!==e.color?`${s}${c}x${a}`:`${s}${c}-${a}`}isCheck(){let e,t;for(let i=0;i<10;i++)for(let o=0;o<10;o++){const r=this.board[i][o];if(r&&r.type==="king"&&r.color===this.currentPlayer){e=o,t=i;break}}if(e===void 0||t===void 0)return!1;for(let i=0;i<10;i++)for(let o=0;o<10;o++){const r=this.board[i][o];if(r&&r.color!==this.currentPlayer&&this.getAvailableMoves(o,i).some(a=>a.file===e&&a.rank===t))return!0}return!1}isCheckmate(){if(!this.isCheck())return!1;for(let e=0;e<10;e++)for(let t=0;t<10;t++){const i=this.board[e][t];if(i&&i.color===this.currentPlayer&&this.getAvailableMoves(t,e).length>0)return!1}return!0}getPieceIcon(e){return e?p[e.type]:null}}class f{constructor(){this.boardElement=document.getElementById("chessBoard")}initializeBoard(){this.boardElement.innerHTML="";for(let e=0;e<10;e++)for(let t=0;t<10;t++){const i=document.createElement("div");i.className="cell",i.dataset.coord=`${t}${e}`,(t+e)%2===0?i.classList.add("light-square"):i.classList.add("dark-square"),this.boardElement.appendChild(i)}}renderBoard(e){document.querySelectorAll(".chess-piece").forEach(o=>o.remove());const i=e.flippedBoard||e;for(let o=0;o<10;o++)for(let r=0;r<10;r++){const s=i[o][r];if(s){const c=s.color;this.renderPiece(r,o,{...s,color:c})}}}renderPiece(e,t,i){const o=this.getCellElement(e,t);if(!o)return;const r=o.querySelector(".chess-piece");r&&r.remove();const s=document.createElement("i");s.className=`fas ${this.getPieceIcon(i.type)} chess-piece ${i.color}`,s.dataset.piece=i.type,s.dataset.color=i.color,o.appendChild(s)}getPieceIcon(e){return{king:"fa-chess-king",queen:"fa-chess-queen",rook:"fa-chess-rook",bishop:"fa-chess-bishop",knight:"fa-chess-knight",pawn:"fa-chess-pawn",trebuchet:"fa-tower-observation"}[e]||"fa-question"}getCellElement(e,t){return document.querySelector(`.cell[data-coord="${e}${t}"]`)}highlightPiece(e,t,i){const o=this.getCellElement(e,t);o&&o.classList.add(i)}highlightMoves(e){this.clearMoveHighlights(),e.forEach(t=>{const i=this.getCellElement(t.file,t.rank);if(i){const o=document.createElement("div");o.className=`highlight ${t.capture?"capture-move":"available-move"}`,i.appendChild(o)}})}clearHighlights(){this.clearSelectionHighlights(),this.clearMoveHighlights()}clearSelectionHighlights(){document.querySelectorAll(".selected-piece").forEach(t=>{t.classList.remove("selected-piece")})}clearMoveHighlights(){document.querySelectorAll(".highlight").forEach(t=>{t.remove()})}}class y{constructor(){this.game=new g,this.renderer=new f,this.selectedPiece=null,this.availableMoves=[],this.initialize()}initialize(){this.renderer.initializeBoard(),this.renderer.renderBoard(this.game.board),this.setupEventListeners(),this.updateGameStatus()}setupEventListeners(){document.getElementById("chessBoard").addEventListener("click",e=>{const t=e.target.closest(".cell");if(!t)return;const i=t.dataset.coord,o=parseInt(i[0]),r=parseInt(i[1]);this.handleCellClick(o,r)}),document.getElementById("resetGame").addEventListener("click",()=>{this.game.reset(),this.renderer.renderBoard(this.game.board),this.updateGameStatus(),this.clearHighlights()}),document.getElementById("undoMove").addEventListener("click",()=>{this.game.undoMove(),this.renderer.renderBoard(this.game.board),this.updateGameStatus(),this.clearHighlights(),this.updateMoveHistory()}),document.getElementById("redoMove").addEventListener("click",()=>{this.game.redoMove(),this.renderer.renderBoard(this.game.board),this.updateGameStatus(),this.clearHighlights(),this.updateMoveHistory()}),document.getElementById("newGame").addEventListener("click",()=>{this.showGameSetupModal()}),document.getElementById("startGame").addEventListener("click",()=>{this.startNewGame()}),document.getElementById("cancelGame").addEventListener("click",()=>{this.hideGameSetupModal()})}handleCellClick(e,t){const i=this.game.board[t][e];if(this.selectedPiece&&(this.selectedPiece.file!==e||this.selectedPiece.rank!==t)&&this.availableMoves.some(r=>r.file===e&&r.rank===t)){this.game.movePiece(this.selectedPiece.file,this.selectedPiece.rank,e,t),this.renderer.renderBoard(this.game.board),this.updateGameStatus(),this.clearHighlights(),this.updateMoveHistory();return}i&&i.color===this.game.currentPlayer?(this.availableMoves=this.game.getAvailableMoves(e,t),this.renderer.highlightPiece(e,t,"selected-piece"),this.renderer.highlightMoves(this.availableMoves),this.selectedPiece={file:e,rank:t,piece:i}):(this.clearHighlights(),this.selectedPiece=null,this.availableMoves=[])}clearHighlights(){this.renderer.clearHighlights()}updateMoveHistory(){const e=document.getElementById("moveList");e.innerHTML="";for(let t=0;t<this.game.moveNotation.length;t++){const i=this.game.moveNotation[t],o=document.createElement("div");o.className=`move-item ${i.player}`;const r=document.createElement("span");r.className="move-number",r.textContent=i.moveNumber+".";const s=document.createElement("span");s.className="move-notation",s.textContent=i.notation,o.appendChild(r),o.appendChild(s),e.appendChild(o)}}updateGameStatus(){const e=document.getElementById("gameStatus");e.textContent=`${this.game.currentPlayer.charAt(0).toUpperCase()+this.game.currentPlayer.slice(1)}'s turn`,this.game.isCheck()&&(e.textContent+=" - CHECK!"),this.game.isCheckmate()&&(e.textContent=`CHECKMATE! ${this.game.currentPlayer==="white"?"Black":"White"} wins!`)}showGameSetupModal(){const e=document.getElementById("gameSetupModal");e.style.display="flex"}hideGameSetupModal(){const e=document.getElementById("gameSetupModal");e.style.display="none"}startNewGame(){const e=document.getElementById("boardOrientation").value,t=document.getElementById("gameMode").value;this.game.reset(),e==="black-bottom"?this.flipBoardOrientation():this.ensureNormalOrientation();const[i,o]=t.split("-");this.game.bottomPlayerType=i,this.game.topPlayerType=o,this.game.currentPlayer=e==="black-bottom"?"black":"white",this.renderer.renderBoard(this.game.board),this.updateGameStatus(),this.clearHighlights(),this.updateMoveHistory(),this.hideGameSetupModal(),console.log(`Starting new game: ${t} with ${e}`),console.log(`Bottom: ${i}, Top: ${o}`)}flipBoardOrientation(){const e=Array(10).fill().map(()=>Array(10).fill(null));for(let t=0;t<10;t++)for(let i=0;i<10;i++){const o=this.game.board[t][i];o&&(e[9-t][9-i]={...o,flipped:!0})}this.game.flippedBoard=e,this.game.boardOrientation="flipped"}ensureNormalOrientation(){this.game.boardOrientation="normal",delete this.game.flippedBoard}}document.addEventListener("DOMContentLoaded",()=>{new y});
